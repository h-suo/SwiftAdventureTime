# Sequence(5)

[Sequence](https://github.com/apple/swift/blob/main/stdlib/public/core/Sequence.swift)ë¡œ ë– ë‚˜ëŠ” ë§ˆì§€ë§‰ ëª¨í—˜ì€ `Sequence`ì˜ ìì£¼ ì‚¬ìš©í•˜ëŠ” ê¸°ë³¸ ë©”ì„œë“œë“¤ì„ ì •ë¦¬í•´ ë³´ê² ìŠµë‹ˆë‹¤! ğŸƒ

<br>

## map
> Sequenceì˜ ìš”ì†Œì— ëŒ€í•´ ì£¼ì–´ì§„ í´ë¡œì €ë¡œ ë§¤í•‘ í•œ ê²°ê³¼ë¥¼ í¬í•¨í•˜ëŠ” ë°°ì—´ì„ ë°˜í™˜í•˜ëŠ” ë©”ì„œë“œ

<br>

```swift
extension Sequence {
    @inlinable
    public func map<T>(
        _ transform: (Element) throws -> T
    ) rethrows -> [T] {
        let initialCapacity = underestimatedCount
        var result = ContiguousArray<T>()
        result.reserveCapacity(initialCapacity)
        
        var iterator = self.makeIterator()
        
        for _ in 0..<initialCapacity {
            result.append(try transform(iterator.next()!))
        }
        
        while let element = iterator.next() {
            result.append(try transform(element))
        }
        
        return Array(result)
    }
}
```
- **transform** : ë§¤í•‘í•˜ê¸° ìœ„í•´ ì£¼ì…ëœ í´ë¡œì €
- **initialCapacity** : ì»¬ë ‰ì…˜ì˜ ìš”ì†Œ ìˆ˜ë³´ë‹¤ ì‘ê±°ë‚˜ ê°™ì€ ê°’ìœ¼ë¡œ ì´ˆê¸° ìš©ëŸ‰ì„ ê³„ì‚°
- **result** : ë°˜í™˜ì„ í•˜ê¸° ìœ„í•œ ê²°ê³¼
- **iterator** : mapì„ ì‚¬ìš©í•˜ëŠ” sequenceì˜ Iterator

> Sequenceì˜ mapì€ underestimatedCountë¡œ ì´ˆê¸° ìš©ëŸ‰ì„ ê³„ì‚°í•˜ì—¬ ContiguousArray íƒ€ì…ì¸ resultì˜ ìš”ì†Œë¥¼ ì €ì¥í•˜ê¸° ìœ„í•œ ì¶©ë¶„í•œ ê³µê°„ì„ í™•ë³´í•œ ë’¤, ì£¼ì–´ì§„ transform í´ë¡œì €ë¥¼ ì´ìš©í•´ ì´ˆê¸° ìš©ëŸ‰ ë§Œí¼ì˜ ìš”ì†Œë¥¼ ë§¤í•‘í•˜ì—¬ resultì— ì¶”ê°€í•˜ì—¬ Array íƒ€ì…ìœ¼ë¡œ ë³€í™˜ í›„ ë°˜í™˜í•©ë‹ˆë‹¤.
> 
> ë˜í•œ resultë¥¼ ë°˜í™˜í•˜ê¸° ì´ì „ì— ë‚¨ì€ ìš”ì†Œê°€ ìˆë‹¤ë©´ ì¶”ê°€ë¡œ ë§¤í•‘í•˜ì—¬ resultì— ì¶”ê°€í•©ë‹ˆë‹¤.

<br>

## filter
> ì£¼ì–´ì§„ ìˆ ì‹ì„ ë§Œì¡±í•˜ëŠ” Sequenceì˜ ìš”ì†Œë¥¼ ìˆœì„œëŒ€ë¡œ í¬í•¨í•˜ëŠ” ë°°ì—´ì„ ë°˜í™˜í•˜ëŠ” ë©”ì„œë“œ

<br>

```swift
extension Sequence {
    @inlinable
    public __consuming func filter(
        _ isIncluded: (Element) throws -> Bool
    ) rethrows -> [Element] {
        return try _filter(isIncluded)
    }
    
    @_transparent
    public func _filter(
        _ isIncluded: (Element) throws -> Bool
    ) rethrows -> [Element] {
        
        var result = ContiguousArray<Element>()
        
        var iterator = self.makeIterator()
        
        while let element = iterator.next() {
            if try isIncluded(element) {
                result.append(element)
            }
        }
        
        return Array(result)
    }
}
```
- **isIncluded** : ì£¼ì–´ì§„ ìˆ ì‹
- **result** : ë°˜í™˜ì„ í•˜ê¸° ìœ„í•œ ê²°ê³¼
- **iterator** : filterë¥¼ ì‚¬ìš©í•˜ëŠ” sequenceì˜ Iterator

> Sequenceì˜ filterëŠ” isIncludedì— ìš”ì†Œë¥¼ ë„£ì–´ trueë¥¼ ë°˜í™˜í•œë‹¤ë©´ resultì— ì¶”ê°€í•˜ì—¬ Array íƒ€ì…ìœ¼ë¡œ ë³€í™˜ í›„ ë°˜í™˜í•©ë‹ˆë‹¤.

<br>

## forEach
> for-in ë£¨í”„ë¥¼ ì‚¬ìš©í•´ Sequenceì˜ ê° ìš”ì†Œì— ëŒ€í•´ ì£¼ì–´ì§„ í´ë¡œì €ë¥¼ ê°™ì€ ìˆœì„œë¡œ í˜¸ì¶œí•˜ëŠ” ë©”ì„œë“œ

<br>

```swift
extension Sequence {
    @_semantics("sequence.forEach")
    @inlinable
    public func forEach(
        _ body: (Element) throws -> Void
    ) rethrows {
        for element in self {
            try body(element)
        }
    }
}
```
- **body** : í˜¸ì¶œë˜ê¸° ìœ„í•œ í´ë¡œì €

> Sequenceì˜ forEachëŠ” ì£¼ì–´ì§„ bodyë¥¼ for-in ë¬¸ë²•ì„ ì´ìš©í•´ ê° ìš”ì†Œë¥¼ ë„£ì–´ í˜¸ì¶œí•©ë‹ˆë‹¤.

<br>

## first(where:)
> ì£¼ì–´ì§„ ìˆ ì‹ì„ ë§Œì¡±í•˜ëŠ” Sequenceì˜ ì²« ë²ˆì§¸ ìš”ì†Œë¥¼ ë°˜í™˜í•˜ëŠ” ë©”ì„œë“œ

<br>

```swift
extension Sequence {
    @inlinable
    public func first(
        where predicate: (Element) throws -> Bool
    ) rethrows -> Element? {
        for element in self {
            if try predicate(element) {
                return element
            }
        }
        return nil
    }
}
```
- **predicate** : ì£¼ì–´ì§„ ìˆ ì‹

> Sequenceì˜ first(where:)ì€ for-in ë¬¸ë²•ì„ ì´ìš©í•´ ìš”ì†Œì— ìˆœì°¨ì ìœ¼ë¡œ ì ‘ê·¼í•˜ì—¬ predicateë¥¼ ë§Œì¡±í•˜ëŠ” ìš”ì†Œê°€ ìˆë‹¤ë©´ ë°˜í™˜í•˜ê³ , ë§Œì¡±í•˜ëŠ” ìš”ì†Œê°€ ì—†ë‹¤ë©´ nilì„ ë°˜í™˜í•©ë‹ˆë‹¤.

<br>

## suffix
> ì£¼ì–´ì§„ ìµœëŒ€ ê¸¸ì´ê¹Œì§€ í•˜ìœ„ Sequenceë¥¼ ë°˜í™˜í•˜ëŠ” ë©”ì„œë“œ

<br>

```swift
extension Sequence {
    @inlinable
    public __consuming func suffix(_ maxLength: Int) -> [Element] {
        _precondition(maxLength >= 0, "Can't take a suffix of negative length from a sequence")
        guard maxLength != 0 else { return [] }
        
        var ringBuffer = ContiguousArray<Element>()
        ringBuffer.reserveCapacity(Swift.min(maxLength, underestimatedCount))
        
        var i = 0
        
        for element in self {
            if ringBuffer.count < maxLength {
                ringBuffer.append(element)
            } else {
                ringBuffer[i] = element
                i += 1
                if i >= maxLength {
                    i = 0
                }
            }
        }
        
        if i != ringBuffer.startIndex {
            var rotated = ContiguousArray<Element>()
            rotated.reserveCapacity(ringBuffer.count)
            rotated += ringBuffer[i..<ringBuffer.endIndex]
            rotated += ringBuffer[0..<i]
            return Array(rotated)
        } else {
            return Array(ringBuffer)
        }
    }
}
```
- **maxLength** : ì£¼ì–´ì§„ ìµœëŒ€ ê¸¸ì´
- **ringBuffer** : ê³µê°„ì„ ì ˆì•½í•˜ê¸° ìœ„í•œ ë²„í¼
- **i** : ringBufferê°€ íšŒì „í•œ í¬ì¸íŠ¸ë¥¼ ì°¾ê¸° ìœ„í•œ ì¸ë±ìŠ¤
- **rotated** : ringBufferê°€ ëŒì•„ê°„ ë§Œí¼ íšŒì „í•œ ê²°ê³¼

> Sequenceì˜ suffixëŠ” maxLengthê°€ ìŒìˆ˜ë¼ë©´ _preconditionì— ì˜í•´ í”„ë¡œê·¸ë¨ì„ ì¢…ë£Œí•©ë‹ˆë‹¤.
> 
> maxLengthê°€ ì •ìƒì ìœ¼ë¡œ ì£¼ì–´ì§„ë‹¤ë©´ for-in ë¬¸ë²•ìœ¼ë¡œ ê° ìš”ì†Œì— ì ‘ê·¼í•˜ì—¬ ringBufferì˜ ê°œìˆ˜ê°€ maxLengthì™€ ê°™ì•„ì§ˆ ë•Œê¹Œì§€ ìš”ì†Œë¥¼ ì¶”ê°€í•œ í›„, ië¥¼ ì´ìš©í•´ ringBufferì— ë‚¨ì€ ìš”ì†Œë¥¼ ì‚½ì…í•©ë‹ˆë‹¤. 
> 
> ringBufferì˜ í¬ê¸°ëŠ” maxLengthê³¼ ê°™ì•„ for-in ë¬¸ë²•ì´ ëë‚˜ëŠ” ì‹œì ì—ëŠ” ringBufferì— í•˜ìœ„ Sequenceì˜ ìš”ì†Œë§Œ ë‚¨ê²Œ ë˜ì§€ë§Œ ìš”ì†Œê°€ ringBufferì— ìˆœì°¨ì ìœ¼ë¡œ ë“¤ì–´ê°„ë‹¤ëŠ” ë³´ì¥ì€ ì—†ìŠµë‹ˆë‹¤. 
> í•˜ì—¬ ìš”ì†Œë¥¼ ì¶”ê°€í•˜ëŠ” ì¤‘ì— iì™€ maxLengthê°€ ê°™ì•„ì§„ë‹¤ë©´ iì— 0ì„ ë„£ì–´ íšŒì „í•œ í¬ì¸íŠ¸ë¥¼ ì°¾ê¸° ìœ„í•œ ì¸ë±ìŠ¤ë¡œ ië¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.
> 
> iì™€ ringBufferì˜ ì‹œì‘ ì¸ë±ìŠ¤ê°€ ê°™ë‹¤ë©´ ringBufferë¥¼ ê·¸ëŒ€ë¡œ Arrayë¡œ ë³€í™˜í•˜ì—¬ ë°˜í™˜í•˜ê³ , ì•„ë‹ˆë¼ë©´ rotatedì— ië¥¼ ê¸°ì¤€ìœ¼ë¡œ ringBufferë¥¼ ë‚˜ëˆ  ì¶”ê°€í•˜ì—¬ ìˆœì„œë¥¼ ë§ì¶˜ ë’¤ Arrayë¡œ ë³€í™˜í•˜ì—¬ ë°˜í™˜í•©ë‹ˆë‹¤.

<br>

## dropLast
> ì£¼ì–´ì§„ ìµœì¢… ìˆ˜ë¥¼ ì œì™¸í•œ ëª¨ë“  ê²ƒì„ í¬í•¨í•˜ëŠ” Sequenceë¥¼ ë°˜í™˜í•˜ëŠ” ë©”ì„œë“œ

<br>

```swift
extension Sequence {
    @inlinable
    public __consuming func dropLast(_ k: Int = 1) -> [Element] {
        _precondition(k >= 0, "Can't drop a negative number of elements from a sequence")
        guard k != 0 else { return Array(self) }
        
        var result = ContiguousArray<Element>()
        var ringBuffer = ContiguousArray<Element>()
        var i = ringBuffer.startIndex
        
        for element in self {
            if ringBuffer.count < k {
                ringBuffer.append(element)
            } else {
                result.append(ringBuffer[i])
                ringBuffer[i] = element
                i += 1
                if i >= k {
                    i = 0
                }
            }
        }
        return Array(result)
    }
}
```
- **k** : ì£¼ì–´ì§„ ìµœì¢… ìˆ˜
- **result** : ë°˜í™˜í•˜ê¸° ìœ„í•œ ê²°ê³¼
- **ringBuffer** : ê³µê°„ì„ ì ˆì•½í•˜ê¸° ìœ„í•œ ë²„í¼
- **i** : ringBufferê°€ íšŒì „í•œ í¬ì¸íŠ¸ë¥¼ ì°¾ê¸° ìœ„í•œ ì¸ë±ìŠ¤

> Sequenceì˜ dropLastëŠ” kê°€ ìŒìˆ˜ë¼ë©´ _preconditionì— ì˜í•´ í”„ë¡œê·¸ë¨ì„ ì¢…ë£Œí•©ë‹ˆë‹¤.
> 
> kê°€ ì •ìƒì ìœ¼ë¡œ ì£¼ì–´ì§„ë‹¤ë©´ for-in ë¬¸ë²•ìœ¼ë¡œ ê° ìš”ì†Œì— ì ‘ê·¼í•˜ì—¬ ringBufferì˜ ê°œìˆ˜ê°€ kì™€ ê°™ì•„ì§ˆ ë•Œê¹Œì§€ ìš”ì†Œë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.
> ì´í›„ ië¥¼ ì´ìš©í•´ ringBufferì˜ ìš”ì†Œë¥¼ resultì— ì¶”ê°€ í›„ ë‚¨ì€ ìš”ì†Œë¥¼ ë‹¤ì‹œ i ë²ˆì§¸ì— ì‚½ì…í•©ë‹ˆë‹¤. 
> 
> iëŠ” ringBufferê°€ íšŒì „í•œ í¬ì¸íŠ¸ë¥¼ ì°¾ê¸° ìœ„í•œ ì¸ë±ìŠ¤ë¡œ ië¥¼ ì¦ê°€ì‹œí‚¤ë‹¤ kì™€ ê°™ì•„ì§„ë‹¤ë©´ 0ìœ¼ë¡œ ì´ˆê¸°í™” ì‹œí‚¤ëŠ” ì‘ì—…ì„ ë°˜ë³µí•©ë‹ˆë‹¤.
> 
> for-in ë¬¸ë²•ì´ ëë‚˜ëŠ” ì‹œì ì—ëŠ” k ë§Œí¼ì˜ ìš”ì†Œê°€ ringBufferì— ë‚¨ì•„ resultì—ì„œëŠ” ì œì™¸ë©ë‹ˆë‹¤.

<br>

## prefix(while:)
> ì£¼ì–´ì§„ ìˆ ì‹ì„ ë§Œì¡±í•˜ëŠ” ì´ˆê¸° ì—°ì† ìš”ì†Œë¥¼ í¬í•¨í•˜ëŠ” Sequenceë¥¼ ë°˜í™˜í•˜ëŠ” ë©”ì„œë“œ

<br>

```swift
extension Sequence {
    @inlinable
    public __consuming func prefix(
        while predicate: (Element) throws -> Bool
    ) rethrows -> [Element] {
        var result = ContiguousArray<Element>()
        
        for element in self {
            guard try predicate(element) else {
                break
            }
            result.append(element)
        }
        return Array(result)
    }
}
```
- **predicate** : ì£¼ì–´ì§„ ìˆ ì‹
- **result** : ë°˜í™˜í•˜ê¸° ìœ„í•œ ê²°ê³¼

> Sequenceì˜ prefix(while:)ì€ for-in ë¬¸ë²•ì„ ì´ìš©í•´ ìš”ì†Œì— ìˆœì°¨ì ìœ¼ë¡œ ì ‘ê·¼í•˜ì—¬ resultì— ìš”ì†Œë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.
> 
> ìš”ì†Œê°€ predicateë¥¼ ë§Œì¡±í•˜ì§€ ì•ŠëŠ”ë‹¤ë©´ for-in ë¬¸ë²•ì„ ì¢…ë£Œì‹œí‚¤ê³  ì´ë¯¸ ì¶”ê°€ëœ ìš”ì†Œë“¤ë§Œ ë°˜í™˜í•©ë‹ˆë‹¤.

<br>

### ì´ê²Œ ë­˜ê¹Œ?

ëª¨í—˜ì„ í•˜ë©° ìƒì†Œí•œ í‚¤ì›Œë“œì™€ ê¸°ëŠ¥ì— ëŒ€í•´ ê°„ë‹¨íˆ ì •ë¦¬í•´ ë´¤ìŠµë‹ˆë‹¤!

- **underestimatedCount** : Sequenceì˜ ìš”ì†Œ ìˆ˜ë³´ë‹¤ ì‘ê±°ë‚˜ ê°™ì€ ê°’ì…ë‹ˆë‹¤.
- **@_transparent** : í•´ë‹¹ í•¨ìˆ˜ê°€ ì›ì‹œ ì—°ì‚°ì²˜ëŸ¼ ë‹¤ë¤„ì ¸ì•¼ í•˜ëŠ” ê²ƒì„ ë‚˜íƒ€ë‚´ëŠ” ì†ì„±ì…ë‹ˆë‹¤
- **@_semantics** : í‘œì¤€ ë¼ì´ë¸ŒëŸ¬ë¦¬ì˜ ì½”ë“œì— ì£¼ì„ì„ ë‹¬ê¸° ìœ„í•œ ì†ì„±ì…ë‹ˆë‹¤.

<br>

---
ì§€ê¸ˆê¹Œì§€ `Sequence`ë¡œ ëª¨í—˜ì„ ë– ë‚˜ë´¤ìŠµë‹ˆë‹¤!
ë‹¤ìŒì€ ìƒˆë¡œìš´ `Swift` ëª¨í—˜ìœ¼ë¡œ ì°¾ì•„ì˜¤ê² ìŠµë‹ˆë‹¤! ğŸ‘‹
